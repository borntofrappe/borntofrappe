<p>Using the <code>fs</code> module and the <code>marked</code> package, I set out to take this markdown file, consider the front matter and then spit out the matching markup.</p>
<p>Bonus points if I manage to add syntax highlighting <a href="https://github.com/octref/shiki">shiki</a>.</p>
<h2 id="fs-and-path" class="permalink">fs and path<a href="#fs-and-path" aria-label="permalink"><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="none" stroke="currentColor" stroke-width="10" stroke-linejoin="round" stroke-linecap="round"><path stroke-dasharray="140 26" stroke-dashoffset="-18" d="M -24 9 a 21 21 0 0 1 0 -42 h 26 a 21 21 0 0 1 0 42 h -26" /><path transform="scale(-1 -1)" stroke-dasharray="140 26" stroke-dashoffset="-18" d="M -24 9 a 21 21 0 0 1 0 -42 h 26 a 21 21 0 0 1 0 42 h -26" /></g></svg></a></h2><p>To find the actual file, it seems I need the <code>path</code> module as well.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">fs</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #82AAFF">require</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">fs</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">path</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #82AAFF">require</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">path</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p>In the current folder, I&#39;m able to read the files with two variants.</p>
<ul>
<li>async</li>
</ul>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">fs</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">readdir</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">./</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">(</span><span style="color: #FF5370">err</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #FF5370">files</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">  </span><span style="color: #A6ACCD">files</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">forEach</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">(</span><span style="color: #FF5370">file</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">    </span><span style="color: #89DDFF">if</span><span style="color: #FFFFFF"> (path</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">extname</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">file</span><span style="color: #FFFFFF">) </span><span style="color: #C792EA">===</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">.md</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">) </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">      </span><span style="color: #FFCB6B">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">file</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #FFFFFF">    </span><span style="color: #89DDFF">}</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><ul>
<li>sync</li>
</ul>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">files</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> fs</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">readdirSync</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">./</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">utf-8</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #A6ACCD">files</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">forEach</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">(</span><span style="color: #FF5370">file</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">if</span><span style="color: #FFFFFF"> (path</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">extname</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">file</span><span style="color: #FFFFFF">) </span><span style="color: #C792EA">===</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">.md</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">) </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">    </span><span style="color: #FFCB6B">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">file</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">}</span>
<span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p>I&#39;m debating which is the best approach. Reading the markdown files seems important enough to warrant the sync, blocking variant, but I associate am open to suggestions/further research.</p>
<p>Let&#39;s stick with the latter for the time being.</p>
<p>To read the content of the actual file, once again, there&#39;s an async and sync variant.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">markdownFiles</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">files</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">filter</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">(</span><span style="color: #FF5370">file</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> path</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">extname</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">file</span><span style="color: #FFFFFF">) </span><span style="color: #C792EA">===</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">.md</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #A6ACCD">markdownFiles</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">forEach</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">(</span><span style="color: #FF5370">file</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">  </span><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">markdown</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> fs</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">readFileSync</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">./</span><span style="color: #89DDFF">${</span><span style="color: #A6ACCD">file</span><span style="color: #89DDFF">}`</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span><span style="color: #FFFFFF"> encoding</span><span style="color: #89DDFF">:</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">utf-8</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #FFFFFF">  </span><span style="color: #FFCB6B">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">markdown</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p>I used the <code>filter</code> method to consider only the markdown files. <code>markdown</code> describes now the actual content. A string.</p>
<h2 id="marked-and-front-matter" class="permalink">marked and front matter<a href="#marked-and-front-matter" aria-label="permalink"><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="none" stroke="currentColor" stroke-width="10" stroke-linejoin="round" stroke-linecap="round"><path stroke-dasharray="140 26" stroke-dashoffset="-18" d="M -24 9 a 21 21 0 0 1 0 -42 h 26 a 21 21 0 0 1 0 42 h -26" /><path transform="scale(-1 -1)" stroke-dasharray="140 26" stroke-dashoffset="-18" d="M -24 9 a 21 21 0 0 1 0 -42 h 26 a 21 21 0 0 1 0 42 h -26" /></g></svg></a></h2><p>The <code>markdown</code> string can be processed with the <code>marked</code> module.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #676E95">// assuming you installed & required marked</span>
<span style="color: #FFCB6B">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #FFFFFF">(</span><span style="color: #82AAFF">marked</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">markdown</span><span style="color: #FFFFFF">))</span><span style="color: #89DDFF">;</span></code></pre></pre><p>Handily enough, I notice the markdown includes a <code>language-*</code> class for every code snippet. Might come in handy later. The headings are also given an <code>id</code> attribute. Helpful to navigate the document.</p>
<p>Enough dilly-dallying though. While marked provides the markdown, it does not consider the front matter. Front matter as in the key-value pairs specified at the top of the <code>.md</code> file, in between <code>---</code> dashes <code>---</code>.</p>
<p>I&#39;m sure there&#39;s a better way to do this, but the following regular expression does the trick.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #89DDFF">/</span><span style="color: #C3E88D">---\r\n</span><span style="color: #89DDFF">(</span><span style="color: #C3E88D">\w</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">:\s.</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">\r\n</span><span style="color: #89DDFF">)</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">---\r\n</span><span style="color: #89DDFF">/</span><span style="color: #89DDFF">;</span></code></pre></pre><p>This portion in particular should improved to identify the entire lines</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #89DDFF">/(</span><span style="color: #C3E88D">\w</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">:\s.</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">\r\n</span><span style="color: #89DDFF">)/</span><span style="color: #89DDFF">;</span></code></pre></pre><p>A word, a colon, a white space character, anything else before the carriage return and the new line character. With this, I am already able to strip out the front matter to use the <code>marked</code> function only on the actual content of the document.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">markdown</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> fs</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">readFileSync</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">./</span><span style="color: #89DDFF">${</span><span style="color: #A6ACCD">file</span><span style="color: #89DDFF">}`</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span><span style="color: #FFFFFF"> encoding</span><span style="color: #89DDFF">:</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">utf-8</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">frontmatter</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">markdown</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">match</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">/</span><span style="color: #C3E88D">---\r\n</span><span style="color: #89DDFF">(</span><span style="color: #C3E88D">\w</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">:\s.</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">\r\n</span><span style="color: #89DDFF">)</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">---\r\n</span><span style="color: #89DDFF">/</span><span style="color: #FFFFFF">)[</span><span style="color: #F78C6C">0</span><span style="color: #FFFFFF">]</span><span style="color: #89DDFF">;</span>
<span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">content</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">markdown</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">slice</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">frontmatter</span><span style="color: #89DDFF">.</span><span style="color: #FFFFFF">length)</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">trim</span><span style="color: #FFFFFF">()</span><span style="color: #89DDFF">;</span></code></pre></pre><p>Of course, I need the front matter and the associated key-value pairs.</p>
<p>I use a similar regular expression, to separate the key value pairs an array.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">keyValue</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">frontmatter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">match</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">/</span><span style="color: #C3E88D">\w</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">:\s.</span><span style="color: #C792EA">+</span><span style="color: #89DDFF">/</span><span style="color: #F78C6C">g</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p>This provides an array of strings, like <code>&#39;title: From markdown to HTML&#39;, &#39;date: 2020-01-20&#39;</code>.</p>
<p>Ultimately, I want to create an object describing the different keys, alongside the markup processed through <code>marked</code>. With this in mind, I first map through the array.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">keyValue</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">frontmatter</span>
<span style="color: #89DDFF">  </span><span style="color: #676E95">// array of strings</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">match</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">/</span><span style="color: #C3E88D">\w</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">:\s.</span><span style="color: #C792EA">+</span><span style="color: #89DDFF">/</span><span style="color: #F78C6C">g</span><span style="color: #FFFFFF">)</span>
<span style="color: #89DDFF">  </span><span style="color: #676E95">// 2d array describing the key-value pairs</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">(</span><span style="color: #FF5370">pair</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">pair</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">split</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">: </span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">))</span><span style="color: #89DDFF">;</span></code></pre></pre><p>And then create an object describing the different pairs in the desired schema.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">keyValue</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">frontmatter</span>
<span style="color: #89DDFF">  </span><span style="color: #676E95">// array of strings</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">match</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">/</span><span style="color: #C3E88D">\w</span><span style="color: #C792EA">+</span><span style="color: #C3E88D">:\s.</span><span style="color: #C792EA">+</span><span style="color: #89DDFF">/</span><span style="color: #F78C6C">g</span><span style="color: #FFFFFF">)</span>
<span style="color: #89DDFF">  </span><span style="color: #676E95">// 2d array describing the key-value pairs</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">(</span><span style="color: #FF5370">pair</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">pair</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">split</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">: </span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF">))</span>
<span style="color: #89DDFF">  </span><span style="color: #676E95">// object separating the pairs</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">reduce</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">(</span><span style="color: #FF5370">acc</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #FF5370">curr</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">    </span><span style="color: #A6ACCD">acc</span><span style="color: #FFFFFF">[</span><span style="color: #A6ACCD">curr</span><span style="color: #FFFFFF">[</span><span style="color: #F78C6C">0</span><span style="color: #FFFFFF">]] </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">curr</span><span style="color: #FFFFFF">[</span><span style="color: #F78C6C">1</span><span style="color: #FFFFFF">]</span><span style="color: #89DDFF">;</span>
<span style="color: #FFFFFF">    </span><span style="color: #89DDFF">return</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">acc</span><span style="color: #89DDFF">;</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">},</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p>Took me a while to set it up, but it seems to work. With this object, I can finally add an <code>html</code> field with the <code>marked</code> content and complete the necessary instructions.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">content</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">markdown</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">slice</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">frontmatter</span><span style="color: #89DDFF">.</span><span style="color: #FFFFFF">length)</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">trim</span><span style="color: #FFFFFF">()</span><span style="color: #89DDFF">;</span>

<span style="color: #FFCB6B">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #FFFFFF">(</span>
<span style="color: #FFFFFF">  </span><span style="color: #FFCB6B">Object</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">assign</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">keyValue</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">    html</span><span style="color: #89DDFF">:</span><span style="color: #FFFFFF"> </span><span style="color: #82AAFF">marked</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">content</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">,</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span>
<span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p>Instead of logging the object in the console however, I finally change the <code>forEach</code> method to a map, and return the data structure in a posts array.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">posts</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">markdownFiles</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #FFFFFF">(</span><span style="color: #FF5370">file</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #89DDFF">  </span><span style="color: #676E95">// create desired data structure</span>
<span style="color: #FFFFFF">  </span><span style="color: #89DDFF">return</span><span style="color: #FFFFFF"> </span><span style="color: #FFCB6B">Object</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">assign</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">keyValue</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span><span style="color: #FFFFFF"> html</span><span style="color: #89DDFF">:</span><span style="color: #FFFFFF"> </span><span style="color: #82AAFF">marked</span><span style="color: #FFFFFF">(</span><span style="color: #A6ACCD">content</span><span style="color: #FFFFFF">) </span><span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #89DDFF">}</span></code></pre></pre><p>This is what is ultimately picked up by sapper, but already I can create <code>.html</code> files using the <code>writeFileSync</code> function.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #A6ACCD">posts</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">forEach</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">({</span><span style="color: #FFFFFF"> </span><span style="color: #FF5370">title</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #FF5370">html</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">})</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">{</span>
<span style="color: #FFFFFF">  fs</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">writeFileSync</span><span style="color: #FFFFFF">(</span><span style="color: #89DDFF">`${</span><span style="color: #A6ACCD">title</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">replace</span><span style="color: #C3E88D">(</span><span style="color: #89DDFF">/</span><span style="color: #C3E88D"> </span><span style="color: #89DDFF">/</span><span style="color: #F78C6C">g</span><span style="color: #89DDFF">,</span><span style="color: #C3E88D"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">-</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">)</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">toLowerCase</span><span style="color: #C3E88D">()</span><span style="color: #89DDFF">}</span><span style="color: #C3E88D">.html</span><span style="color: #89DDFF">`</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">html</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span>
<span style="color: #89DDFF">}</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p>There will be a better way to create the <code>slug</code>, but it&#39;s something to consider in sapper itself.</p>
<p>As a matter of fact, I can just use the name of the file for the slug.</p>
<pre><div><svg aria-hidden="true" aria-focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="-50 -50 100 100" width="1em" height="1em"><g fill="currentColor" stroke="none"><path d="M-50-50V50.8h38.4c-8.88 0-16.08-7.2-16.08-16.08v-5.04h10.08v5.04c0 3.36 2.64 6 6 6s6-2.64 6-6V.88H4.48v33.84c0 8.88-7.2 16.08-16.08 16.08H9.52V40.72H24.64c2.88 0 5.04-2.208 5.04-5.04s-2.184-5.04-5.04-5.04c-8.4 0-15.12-6.72-15.12-15.12S16.24.4 24.64.4h13.2v10.08h-13.2c-2.88 0-5.04 2.208-5.04 5.04s2.184 5.04 5.04 5.04c8.4 0 15.12 6.72 15.12 15.12S33.04 50.8 24.64 50.8h24V-50h-100.8z"/></g></svg><span>js</span></div><pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">const</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">slug</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">=</span><span style="color: #FFFFFF"> </span><span style="color: #A6ACCD">file</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">slice</span><span style="color: #FFFFFF">(</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">,</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">-</span><span style="color: #F78C6C">3</span><span style="color: #FFFFFF">)</span><span style="color: #89DDFF">;</span></code></pre></pre><p><code>-3</code> being the number of characters in the extension.</p>
<p>I slightly polished the code and decided to create two folders in which to separate the actual content: <code>blog</code> contains the markdown files to be read and parsed, <code>pages</code> describes where the markup is going to be generated.</p>
