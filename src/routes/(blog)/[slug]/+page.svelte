<script>
  import site from "$lib/site";
  import { onMount } from "svelte";

  /** @type {{ data: import('./$types').PageData }} */
  let { data } = $props();

  /** @type { HTMLElement }*/
  let footer;
  onMount(() => {
    if (matchMedia("(prefers-reduced-motion)").matches) return;

    const div = /** @type { HTMLDivElement  }*/ (
      footer.querySelector("div:last-of-type")
    );
    const paths = /** @type { NodeListOf<SVGPathElement> }*/ (
      footer.querySelectorAll("svg path")
    );

    paths.forEach((path, i) => {
      path.style.opacity = "0";
      path.setAttribute("pathLength", "1");
      path.style.strokeDasharray = "1";
      path.style.strokeDashoffset = "1";
      const delay = 0.12 + i * 0.05;
      path.style.transition = `stroke-dashoffset 0.5s ${delay}s ease-in-out, opacity 0.1s ${delay}s ease-in-out`;
    });
    paths[paths.length - 2].style.transitionDelay = "3.2s";
    paths[paths.length - 1].style.transitionDelay = "3.5s";

    const intersectionObserver = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting) {
        intersectionObserver.unobserve(div);
        paths.forEach((path) => {
          path.style.opacity = "1";
          path.style.strokeDashoffset = "0";
        });
      }
    });

    intersectionObserver.observe(div);

    return () => {
      intersectionObserver.unobserve(div);
    };
  });
</script>

<svelte:head>
  <title>{data.title} | {site.title}</title>
  <meta name="description" content={data.description} />
</svelte:head>

<article>
  <main>
    <h1 class="[ heading ]">{data.title}</h1>

    {@render data.content()}
  </main>
  <hr />
  <footer bind:this={footer}>
    <!-- prettier-ignore -->
    <svg style="display: block" viewBox="0.75 -10.560001373291016 51 13.750001907348633">
        <g fill="none" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M 1 1.5 2.25 2.33 2.97 2.7 3.57 2.87 4.18 2.94 4.8 2.91 5.49 2.81 6.24 2.63 7.05 2.39 7.93 2.08 8.74 1.84 9.49 1.67 10.18 1.57 10.8 1.53 11.36 1.57 11.86 1.69 12.3 1.87 12.68 2.12 13.05 2.31 13.43 2.43 13.8 2.5 14.18 2.5 14.55 2.43 14.93 2.31 15.3 2.12 15.68 1.87 16.04 1.68 16.38 1.56 16.71 1.5 17.02 1.5 17.32 1.56 17.6 1.68 17.87 1.87 18.12 2.12 18.38 2.31 18.67 2.43 18.96 2.5 19.27 2.5 19.6 2.43 19.94 2.31 20.3 2.12 20.68 1.87 21.05 1.67 21.43 1.5 21.8 1.4 22.18 1.34 22.55 1.32 22.93 1.35 23.3 1.43 23.68 1.55 24.04 1.65 24.38 1.73 24.71 1.78 25.02 1.82 25.32 1.83 25.6 1.8 25.87 1.76 26.12 1.71 26.37 1.67 26.62 1.65 26.87 1.66 27.12 1.69 27.37 1.75 27.62 1.83 27.87 1.93 28.12 2.05 28.37 2.15 28.62 2.21 28.87 2.25 29.12 2.25 29.37 2.21 29.62 2.15 29.87 2.05 30.12 1.93 30.37 1.83 30.62 1.75 30.87 1.69 31.12 1.66 31.37 1.65 31.62 1.67 31.87 1.71 32.12 1.76 32.37 1.81 32.62 1.85 32.87 1.87 33.12 1.87 33.4 1.84 33.71 1.79 34.15 1.7 35 1.5" />
          <g stroke-width="0.4">
            <path d="M 34.4 -2.28 34.24 -2.91 34.14 -3.21 34.04 -3.42 33.94 -3.57 33.82 -3.69 33.69 -3.79 33.54 -3.88 33.37 -3.94 33.19 -3.98 33.01 -4.01 32.83 -4.02 32.67 -4.01 32.5 -4 32.35 -3.96 32.2 -3.89 32.05 -3.82 31.92 -3.73 31.78 -3.63 31.66 -3.51 31.53 -3.38 31.42 -3.24 31.3 -3.08 31.2 -2.92 31.1 -2.75 31.00 -2.57 30.91 -2.4 30.81 -2.25 30.7 -2.12 30.58 -2 30.46 -1.91 30.34 -1.81 30.21 -1.75 30.06 -1.71 29.93 -1.68 29.81 -1.65 29.69 -1.64 29.56 -1.64 29.45 -1.65 29.35 -1.68 29.25 -1.71 29.16 -1.75 29.08 -1.79 29.00 -1.83 28.95 -1.85 28.91 -1.88 28.87 -1.9 28.86 -1.91 28.85 -1.91 28.85 -1.91 28.83 -1.91 28.81 -1.89 28.77 -1.87 28.72 -1.83 28.66 -1.79 28.59 -1.74 28.51 -1.68 28.42 -1.60 28.34 -1.54 28.27 -1.48 28.21 -1.41 28.17 -1.33 28.13 -1.25 28.12 -1.20 28.11 -1.13 28.11 -1.04 28.11 -0.99 28.11 -0.94 28.11 -0.89 28.11 -0.85 28.11 -0.83 28.11 -0.81 28.11 -0.79 28.11 -0.79 28.12 -0.79 28.15 -0.79 28.2 -0.77 28.27 -0.75 28.35 -0.73 28.45 -0.69 28.58 -0.64 28.72 -0.60 28.84 -0.56 28.94 -0.52 29.03 -0.49 29.11 -0.48 29.16 -0.45 29.2 -0.44 29.22 -0.42 29.22 -0.42 29.21 -0.42 29.19 -0.41 29.17 -0.41 29.15 -0.38 29.12 -0.36 29.08 -0.32 29.04 -0.28 29 -0.23 28.97 -0.17 28.95 -0.13 28.94 -0.08 28.94 -0.04 28.95 0 28.97 0.040 29 0.089 29.04 0.139 29.08 0.179 29.12 0.209 29.15 0.230 29.17 0.25 29.19 0.259 29.21 0.259 29.22 0.259 29.22 0.25 29.22 0.240 29.22 0.230 29.22 0.230 29.22 0.230 29.22 0.230 29.22 0.240 29.22 0.25 29.22 0.259 29.22 0.269 29.24 0.290 29.25 0.299 29.3 0.299 29.34 0.309 29.39 0.330 29.45 0.339 29.52 0.349 29.58 0.360 29.63 0.370 29.67 0.379 29.71 0.379 29.73 0.370 29.75 0.360 29.75 0.349 29.75 0.339 29.75 0.339 29.78 0.360 29.8 0.379 29.82 0.419 29.85 0.480 29.89 0.549 29.93 0.629 29.97 0.719 30.03 0.799 30.1 0.870 30.18 0.929 30.27 0.969 30.37 1.009 30.49 1.030 30.62 1.049 30.75 1.049 30.91 1.019 31.05 0.96 31.2 0.879 31.34 0.780 31.5 0.650 31.65 0.490 31.81 0.309 31.98 0.099 32.11 -0.08 32.24 -0.24 32.34 -0.37 32.42 -0.46 32.49 -0.54 32.53 -0.60 32.55 -0.62 32.55 -0.62 32.54 -0.62 32.51 -0.60 32.51 -0.58 32.48 -0.54 32.46 -0.5 32.42 -0.44 32.38 -0.37 32.33 -0.30 32.28 -0.24 32.22 -0.16 32.16 -0.07 32.09 0.019 32.01 0.120 31.94 0.219 31.85 0.330 31.75 0.450 31.71 0.549 31.71 0.629 31.75 0.690 31.85 0.740 31.99 0.769 32.17 0.780 32.4 0.780 32.69 0.75 32.94 0.719 33.18 0.660 33.39 0.589 33.59 0.509 33.76 0.419 33.92 0.309 34.05 0.190 34.17 0.049 34.26 -0.09 34.36 -0.26 34.42 -0.44 34.46 -0.62 34.49 -0.85 34.49 -1.10 34.47 -1.5 34.4 -2.28" />
            <path d="M 32 0.85 31.9 1.5" />
            <path d="M 33.05 0.8 32.95 1.5" />
            <path d="M 34.4 -2.6 34.8 -2.5 34.5 -2" />
            <path d="M 33.19 -2.7 A 0.1 0.1 0 0 0 33.21 -2.7 0.1 0.1 0 0 0 33.19 -2.7" />
          </g>
          <path transform="translate(38 -11)" d="M 4 2 3.78 1.57 3.64 1.36 3.52 1.22 3.38 1.1 3.22 1 3.05 0.92 2.85 0.84 2.62 0.77 2.37 0.71 2.13 0.69 1.91 0.72 1.71 0.8 1.52 0.92 1.35 1.1 1.19 1.32 1.04 1.58 0.92 1.89 0.82 2.23 0.76 2.58 0.74 2.97 0.74 3.38 0.77 3.81 0.83 4.27 0.93 4.75 1.05 5.25 1.2 5.7 1.37 6.1 1.57 6.46 1.79 6.77 2.03 7.04 2.29 7.25 2.58 7.43 2.89 7.55 3.2 7.63 3.5 7.66 3.78 7.65 4.07 7.59 4.34 7.48 4.61 7.32 4.87 7.12 5.12 6.87 5.38 6.59 5.67 6.27 5.96 5.93 6.27 5.55 6.6 5.15 6.94 4.71 7.3 4.25 7.68 3.75 7.96 3.27 8.15 2.83 8.25 2.43 8.25 2.05 8.15 1.71 7.96 1.39 7.68 1.11 7.3 0.86 6.99 0.76 6.74 0.82 6.55 1.04 6.43 1.43 6.36 1.96 6.36 2.65 6.43 3.5 6.55 4.5 6.68 5.32 6.8 5.98 6.93 6.46 7.05 6.77 7.18 6.91 7.3 6.88 7.43 6.68 7.55 6.3 7.68 6.02 7.8 5.84 7.93 5.75 8.05 5.75 8.18 5.84 8.3 6.02 8.43 6.3 8.55 6.68 8.67 6.96 8.78 7.15 8.88 7.25 8.97 7.25 9.06 7.15 9.14 6.96 9.21 6.68 9.27 6.3 9.32 6 9.37 5.78 9.41 5.65 9.44 5.58 9.47 5.6 9.48 5.7 9.5 5.87 9.5 6.12 9.5 6.34 9.51 6.52 9.53 6.68 9.57 6.8 9.61 6.9 9.65 6.96 9.71 7 9.77 7 9.83 6.97 9.89 6.92 9.96 6.85 10.02 6.75 10.08 6.63 10.14 6.5 10.21 6.33 10.27 6.14 10.34 5.98 10.42 5.84 10.5 5.72 10.6 5.63 10.7 5.56 10.81 5.52 10.93 5.5 11.05 5.5 11.16 5.52 11.26 5.56 11.34 5.63 11.4 5.72 11.44 5.84 11.48 5.98 11.5 6.14 11.5 6.33 11.5 6.5 11.51 6.63 11.53 6.75 11.57 6.85 11.61 6.92 11.65 6.97 11.71 7 11.77 7 11.83 6.97 11.89 6.92 11.96 6.85 12.02 6.75 12.08 6.63 12.14 6.5 12.21 6.33 12.27 6.14 12.34 5.98 12.42 5.84 12.5 5.72 12.6 5.63 12.7 5.56 12.81 5.52 12.93 5.5 13.05 5.5 13.16 5.51 13.26 5.54 13.34 5.59 13.4 5.65 13.44 5.72 13.48 5.82 13.5 5.93 13.5 6.05 13.47 6.17 13.42 6.28 13.35 6.38 13.25 6.47 13.14 6.55 13 6.63 12.83 6.71 12.64 6.76 12.48 6.85 12.36 6.96 12.27 7.09 12.21 7.26 12.18 7.47 12.2 7.73 12.28 8.15 12.5 9" />
          <path transform="translate(38 -11)" d="M 9.49 4.5 A 0.1 0.1 0 0 0 9.51 4.5 0.1 0.1 0 0 0 9.49 4.5 Z" />
        </g>
      </svg>
    <div></div>
  </footer>
</article>

<style>
  main::before {
    content: "";
    position: fixed;
    background: currentColor;
    inset-block-start: 0;
    inset-inline-start: 0;
    inline-size: 100%;
    block-size: var(--scroll-block-size, 1ex);
    transform-origin: 0% 50%;
    animation: progress auto;
    animation-timeline: scroll();
    z-index: 1;
  }

  @keyframes progress {
    from {
      transform: scaleX(0);
    }
    to {
      transform: scaleX(1);
    }
  }

  main > :global(p) {
    max-inline-size: 70ch;
  }

  main > :global(blockquote) {
    max-inline-size: 50ch;
  }

  main > :global(:is(h1, h2, h3)) {
    --measure--1: 30ch;
  }

  main > :global(* + *) {
    margin-block-start: var(--flow-space, 1em);
  }

  main > :global(:is(h1, h2, h3, blockquote, pre)) {
    --flow-space: 1.1em;
  }

  main > :global(:is(div, figure, table)) {
    --flow-space: 1.5em;
  }

  main > :global(:is(h1, h2, h3) + *) {
    --flow-space: 0.6em;
  }

  main > :global(:is(ul, ol)) {
    padding-inline-start: 1em;
  }

  hr {
    opacity: 0;
    block-size: var(--space-xl);
  }

  footer > svg {
    max-inline-size: 60ch;
  }

  footer > * + * {
    margin-block-start: var(--space-m);
  }
</style>
